% -*- mode: latex; fill-column: 120; -*-

This guide performs stateful provisioning in two steps: First, a generic system
image is installed on the {\em compute} nodes. Later, after a reboot, \xCAT{}
executes a  {\em postbootscript}, which installs   \OHPC{} packages and performs
additional customization. The following subsections show how the base OS is
installed and how the post installation script is set up.

\subsubsection{Create BOS image} \label{sec:assemble_bos}

To create a minimal, default image for use with \xCAT{} you will first need to
have a local copy of the ISO image available for the underlying OS. In this
recipe, the relevant ISO image is \texttt{CentOS-7-x86\_64-DVD-1611.iso}
(available from the CentOS mirrors). We initialize the image creation process
using the \texttt{copycds} command assuming that the necessary ISO image is
available locally in \texttt{\$\{iso\_path\}} as follows:

% begin_ohpc_run
% ohpc_comment_header Initialize OS images for use with xCAT \ref{sec:assemble_bos}
\begin{lstlisting}[language=bash,literate={-}{-}1,keywords={},upquote=true,keepspaces,literate={BOSVER}{\baseos{}}1]
[sms](*\#*) copycds ${iso_path}/CentOS-7-x86_64-DVD-1611.iso
\end{lstlisting}
% end_ohpc_run

\noindent Once completed, several OS images should be available for use within \xCAT{}. These can be queried via:

\begin{lstlisting}[language=bash,literate={-}{-}1,keywords={},upquote=true,keepspaces,literate={BOSVER}{\baseos{}}1]
# Query available images
[sms](*\#*) lsdef -t osimage
centos7.3-x86_64-install-compute  (osimage)
centos7.3-x86_64-netboot-compute  (osimage)
centos7.3-x86_64-statelite-compute  (osimage)
\end{lstlisting}


The first image, {\em install-compute}, is for stateful provisioning of the {\em
compute} nodes and will be used in this recipe.  The other two, {\em
netboot-compute} and {\em statelite-compute}, are for stateless and statelite
installations, respectively. \OHPC{} provides a stateless \xCAT{} recipe,
consult additional documentation if you are interested in that type of install.
Statelite installation is an intermediate type of install, in which a limited
number of files and directories persist across reboots.  Please consult
available xCAT \href{https://xcat-docs.readthedocs.io/en/stable/}{\color{blue}
documentation} if interested in this type of install.
